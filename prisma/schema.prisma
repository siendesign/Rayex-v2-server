generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String   @id @default(cuid())
  name               String
  email              String   @unique
  password           String
  phone              String?
  status             String   @default("active")
  role               String   @default("user")
  verificationStatus String   @default("unverified")
  totalOrders        Int      @default(0)
  totalVolume        Float    @default(0)
  joinedAt           DateTime @default(now())
  lastActive         DateTime @default(now())
  orders             Order[]

  @@map("users")
}

model Currency {
  id             String          @id @default(cuid())
  code           String          @unique
  name           String
  symbol         String
  flag           String
  type           String
  decimals       Int             @default(2)
  active         Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  ratesFrom      ExchangeRate[]  @relation("FromCurrencyRate")
  ratesTo        ExchangeRate[]  @relation("ToCurrencyRate")
  ordersFrom     Order[]         @relation("FromCurrency")
  ordersTo       Order[]         @relation("ToCurrency")
  paymentMethods PaymentMethod[]

  @@map("currencies")
}

model ExchangeRate {
  id             String   @id @default(cuid())
  fromCurrencyId String
  toCurrencyId   String
  rate           Float
  buyRate        Float
  sellRate       Float
  lastUpdated    DateTime @default(now())
  autoUpdate     Boolean  @default(false)
  active         Boolean  @default(true)
  fromCurrency   Currency @relation("FromCurrencyRate", fields: [fromCurrencyId], references: [id], onDelete: Cascade)
  toCurrency     Currency @relation("ToCurrencyRate", fields: [toCurrencyId], references: [id], onDelete: Cascade)

  @@unique([fromCurrencyId, toCurrencyId])
  @@map("exchange_rates")
}

model PaymentMethod {
  id            String   @id @default(cuid())
  name          String
  type          String
  currencyId    String
  active        Boolean  @default(true)
  bankName      String?
  accountName   String?
  accountNumber String?
  routingNumber String?
  swift         String?
  iban          String?
  walletAddress String?
  network       String?
  instructions  String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  orders        Order[]
  currency      Currency @relation(fields: [currencyId], references: [id], onDelete: Cascade)

  @@map("payment_methods")
}

model Order {
  id                     String        @id @default(cuid())
  userId                 String
  fromCurrencyId         String
  fromAmount             Float
  toCurrencyId           String
  toAmount               Float
  status                 String        @default("pending_payment")
  paymentMethodId        String
  recipientName          String?
  recipientBank          String?
  recipientAccountNumber String?
  recipientSwift         String?
  recipientWalletAddress String?
  exchangeRate           Float
  fee                    Float
  notes                  String?
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt
  fromCurrency           Currency      @relation("FromCurrency", fields: [fromCurrencyId], references: [id])
  paymentMethod          PaymentMethod @relation(fields: [paymentMethodId], references: [id])
  toCurrency             Currency      @relation("ToCurrency", fields: [toCurrencyId], references: [id])
  user                   User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("orders")
}
